<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo</title>

<style>
:root {
  --red:#c62828;
}
body {
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#eef2f7,#ffffff);
  padding:30px;
  text-align:center;
}
.card {
  background:white;
  border-radius:22px;
  padding:28px;
  margin:0 auto 22px;
  max-width:760px;
  box-shadow:0 18px 45px rgba(0,0,0,.12);
}
.grid {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:14px;
  margin-top:20px;
}
.cell {
  border-radius:16px;
  border:2px solid #333;
  min-height:95px;
  padding:8px;
  font-size:12px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:.35;
  transition:.15s;
}
.cell.active { opacity:1; cursor:pointer; }
.cell.marked {
  background:var(--red);
  color:white;
  border-color:var(--red);
  transform:scale(1.04);
}
button {
  background:var(--red);
  color:white;
  border:none;
  padding:14px 26px;
  border-radius:16px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>ü©∫ Medic Bingo</h1>

<div class="card" id="login">
  <input id="name" placeholder="Discord name"><br><br>
  <button id="startBtn">üéüÔ∏è Get My Bingo Card</button>
</div>

<div class="card" id="game" style="display:none;">
  <h2 id="player"></h2>
  <div class="grid" id="grid"></div>
  <br>
  <button id="claimBtn">üéâ Claim Bingo</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const WORDS = [
  "Stethoscope","Blood Pressure Cuff","Pulse Oximeter","Thermometer",
  "Defibrillator","AED","IV Pump","IV Drip","Syringe","Needle",
  "Oxygen Tank","Oxygen Mask","Bag Valve Mask","Ventilator",
  "Heart Monitor","ECG Leads","Ultrasound","Laryngoscope",
  "Suction Unit","Crash Cart","Gloves","Face Mask","Gown",
  "Tourniquet","Splint","CPR","Intubation","Paramedic","EMT",
  "Emergency Room","Ambulance","Code Blue","Cardiac Arrest",
  "Medical Chart","Radio Call","Life Support","Night Shift",
  "Bleeding Control","Blue Light Run","Sirens On"
];

const LINES=[
  [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],
  [15,16,17,18,19],[20,21,22,23,24],
  [0,5,10,15,20],[1,6,11,16,21],
  [2,7,12,17,22],[3,8,13,18,23],
  [4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]
];

let card=[],marked=[],called=[],lastReset=null;

startBtn.onclick=async()=>{
  const n=name.value.trim();
  if(!n) return alert("Enter name");

  card=[...WORDS].sort(()=>0.5-Math.random()).slice(0,25);
  card[12]="FREE";
  marked=Array(25).fill(false);
  marked[12]=true;

  await db.collection("players").doc(n).set({
    card,marked,bingo:false
  });

  player.innerText=n;
  login.style.display="none";
  game.style.display="block";
  render();
};

function render(){
  grid.innerHTML="";
  card.forEach((v,i)=>{
    const active=called.includes(v)||v==="FREE";
    const c=document.createElement("div");
    c.className="cell"+(marked[i]?" marked":"")+(active?" active":"");
    c.innerText=v;
    if(active){
      c.onclick=async()=>{
        marked[i]=!marked[i];
        render();
        await db.collection("players").doc(player.innerText).update({marked});
      };
    }
    grid.appendChild(c);
  });
}

claimBtn.onclick=async()=>{
  if(!LINES.some(l=>l.every(i=>marked[i])))
    return alert("No bingo yet");
  await db.collection("players").doc(player.innerText)
    .update({bingo:true,time:new Date().toISOString()});
  alert("Bingo claimed!");
};

db.collection("game").doc("state").onSnapshot(doc=>{
  if(!doc.exists) return;
  const d=doc.data();
  called=d.called||[];
  if(lastReset!==null && d.resetCounter>lastReset){
    alert("Game reset");
    location.reload();
  }
  lastReset=d.resetCounter;
  render();
});
</script>
</body>
</html>
