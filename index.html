<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo</title>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg, #eaf6f6, #ffffff);
  padding: 30px;
  text-align: center;
  color: #333;
}

h1 {
  color: #b71c1c;
  margin-bottom: 5px;
}

.subtitle {
  color: #555;
  margin-bottom: 25px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  margin: 0 auto 20px;
  max-width: 520px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.1);
}

input {
  padding: 12px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 100%;
  max-width: 320px;
}

button {
  margin-top: 15px;
  padding: 12px 22px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: #b71c1c;
  color: white;
  transition: all 0.2s ease;
}

button:hover {
  background: #d32f2f;
  transform: translateY(-1px);
}

.grid {
  display: grid;
  grid-template-columns: repeat(5, 100px);
  gap: 10px;
  justify-content: center;
  margin-top: 20px;
}

.cell {
  background: #fff;
  border: 2px solid #333;
  border-radius: 12px;
  height: 85px;
  padding: 6px;

  font-size: 11px;
  font-weight: bold;
  line-height: 1.1;

  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;

  word-break: break-word;
  white-space: normal;

  opacity: 0.4;
  transition: all 0.15s ease;
}

.cell.active {
  opacity: 1;
  cursor: pointer;
}

.cell.marked {
  background: #b71c1c;
  color: white;
  border-color: #b71c1c;
}

.footer {
  margin-top: 25px;
  color: #666;
  font-size: 13px;
}
</style>
</head>

<body>

<h1>ðŸ©º Medic Bingo</h1>
<p class="subtitle">Mark squares only when the host calls them</p>

<div class="card" id="loginCard">
  <input id="name" placeholder="Enter your Discord name">
  <br>
  <button onclick="startGame()">Get My Bingo Card</button>
</div>

<div class="card" id="game" style="display:none;">
  <h2 id="playerName"></h2>
  <div class="grid" id="grid"></div>
  <button onclick="claimBingo()">ðŸŽ‰ Claim Bingo</button>
</div>

<p class="footer">Hosted by Medic Bingo Classic</p>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const bingoWords = [
  "Stethoscope","CPR","Bandages","IV Drip","Ambulance",
  "Trauma Kit","Scrubs","Vital Signs","Code Blue","Defibrillator",
  "Syringe","First Responder","Triage","Pulse Check","Oxygen Mask",
  "Heart Monitor","Gloves","Blood Pressure","Paramedic",
  "Emergency Room","Stretchers","Radio Call","Life Support",
  "Medical Chart","Scalpel","Face Mask","Disinfectant",
  "Thermometer","AED","Patient Transport","ECG Leads","Bag Valve Mask",
  "Ventilator","Oxygen Regulator","IV Cannula","Infusion Set","Suction Catheter",
  "Yankauer Suction","Portable Monitor","Nebuliser","Infusion Pump","Guaze Pads",
  "Alcohol Wipes","Saline Flush","Sharps Container","Bioharzard Bin","Tourniquet Strap",
  "Trauma Shears","Cervical Collar","Backboard","Airway Management","Manual Ventilation",
  "Wound Irrigation","Bleeding Control","Cardiac Monitoring","Oxygen Therapy","IV Access",
  "Patient Handover","Vital Recording","Pain Assessment","Resus Bay","Trauma Ward",
  "ICU Bed","Helipad","Ambulance Bay","Operating Theatre","Radiology Suite",
  "Recovery Room","Cardiac Event","Respiratory Distress","Major Hemorrhage","Anaphylactic Reaction",
  "Stroke Pathway","Sepsis Alert","Trauma Activation","Incident Report","Observation Chart"
];

let card = [];
let marked = [];
let calledWords = [];
let lastReset = null;

function generateCard() {
  let shuffled = [...bingoWords].sort(() => 0.5 - Math.random());
  let card = shuffled.slice(0, 25);
  card[12] = "ðŸ©º FREE";
  return card;
}

async function startGame() {
  const name = document.getElementById("name").value.trim();
  if (!name) return alert("Enter your Discord name");

  const gameDoc = await db.collection("game").doc("state").get();
  calledWords = gameDoc.exists ? gameDoc.data().calledWords : [];

  const ref = db.collection("players").doc(name);
  const snap = await ref.get();

  if (snap.exists) {
    card = snap.data().card;
    marked = snap.data().marked;
  } else {
    card = generateCard();
    marked = Array(25).fill(false);
    marked[12] = true;

    await ref.set({ card, marked, bingo:false, time:null });
  }

  document.getElementById("playerName").innerText = name;
  document.getElementById("loginCard").style.display = "none";
  document.getElementById("game").style.display = "block";
  render();
}

function render() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  card.forEach((v,i)=>{
    const cell = document.createElement("div");
    const active = calledWords.includes(v) || v === "ðŸ©º FREE";

    cell.className = "cell" +
      (marked[i] ? " marked" : "") +
      (active ? " active" : "");

    cell.innerText = v;

    if (active) {
      cell.onclick = async () => {
        marked[i] = !marked[i];
        render();
        const name = document.getElementById("playerName").innerText;
        await db.collection("players").doc(name).update({ marked });
      };
    }

    grid.appendChild(cell);
  });
}

function checkBingo() {
  const wins = [
    [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],
    [15,16,17,18,19],[20,21,22,23,24],
    [0,5,10,15,20],[1,6,11,16,21],
    [2,7,12,17,22],[3,8,13,18,23],
    [4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]
  ];
  return wins.some(w => w.every(i => marked[i]));
}

async function claimBingo() {
  if (!checkBingo()) {
    alert("âŒ You don't have Bingo yet!");
    return;
  }

  const name = document.getElementById("playerName").innerText;
  const ref = db.collection("players").doc(name);
  const snap = await ref.get();

  if (snap.exists && snap.data().bingo) {
    alert("âš ï¸ You already claimed Bingo.");
    return;
  }

  await ref.set({
    bingo: true,
    time: new Date().toISOString()
  }, { merge: true });

  alert("ðŸŽ‰ Bingo claimed!");
}

/* ðŸ”„ GAME STATE LISTENER */
db.collection("game").doc("state").onSnapshot(doc => {
  if (!doc.exists) return;
  const data = doc.data();
  calledWords = data.calledWords || [];

  if (
    typeof data.resetCounter === "number" &&
    lastReset !== null &&
    data.resetCounter > lastReset
  ) {
    alert("The game has been reset by the host.");
    location.reload();
  }

  lastReset = typeof data.resetCounter === "number"
    ? data.resetCounter
    : lastReset;

  render();
});
</script>

</body>
</html>

