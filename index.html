<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo</title>

<style>
body {
  font-family: "Segoe UI", Arial;
  background: linear-gradient(135deg,#eef2f7,#ffffff);
  padding: 30px;
  text-align: center;
}
.card {
  background: white;
  border-radius: 18px;
  padding: 26px;
  margin: 0 auto 22px;
  max-width: 760px;
  box-shadow: 0 15px 40px rgba(0,0,0,.12);
}
.grid {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:12px;
}
.cell {
  border:2px solid #333;
  border-radius:14px;
  min-height:90px;
  font-size:12px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:.35;
}
.cell.active {opacity:1; cursor:pointer;}
.cell.marked {background:#c62828;color:white;}
.called span {
  background:#fff;
  padding:8px 14px;
  margin:6px;
  border-radius:999px;
  display:inline-block;
}
#near {color:#c62828;font-weight:bold;margin:12px;}
</style>
</head>

<body>

<h1>ğŸ©º Medic Bingo</h1>

<div class="card" id="login">
  <input id="name" placeholder="Discord name"><br><br>
  <select id="mode">
    <option value="words">Medic Words</option>
    <option value="numbers">Numbers</option>
  </select><br><br>
  <button id="startBtn">ğŸŸï¸ Get Bingo Card</button>
</div>

<div class="card" id="game" style="display:none;">
  <h2 id="player"></h2>
  <div id="near"></div>
  <div class="grid" id="grid"></div>
  <br>
  <button id="claimBtn">ğŸ‰ Claim Bingo</button>
</div>

<div class="card">
  <h3>ğŸ“¢ Called So Far</h3>
  <div class="called" id="called"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ğŸ”´ SAME LARGE WORD LIST */
const WORDS = [
  "Stethoscope","Blood Pressure Cuff","Pulse Oximeter","Thermometer",
  "Defibrillator","AED","IV Pump","IV Drip","Syringe","Needle",
  "Oxygen Tank","Oxygen Mask","Bag Valve Mask","Ventilator",
  "Heart Monitor","ECG Leads","Ultrasound","Laryngoscope",
  "Suction Unit","Crash Cart",

  "Gloves","Face Mask","Gown","Visor","Sanitiser",
  "Disinfectant","Sharps Bin","Biohazard Bag","Sterile Field",
  "Dressings","Bandages","Gauze","Tourniquet","Splint",
  "Cervical Collar","Backboard",

  "CPR","Intubation","Cannulation","Blood Draw",
  "Airway Management","Oxygen Therapy","Fluid Resuscitation",
  "Wound Cleaning","Suturing","Manual Ventilation",
  "Rapid Sequence Induction","Defib Shock","Vitals Check",
  "Pain Assessment","Neuro Check",

  "Paramedic","EMT","First Responder","Charge Nurse",
  "Triage Nurse","Consultant","Registrar","Medical Student",
  "Anaesthetist","Radiographer","Pharmacist",

  "Emergency Room","Resus Bay","Trauma Room","ICU",
  "Ambulance","Helipad","Waiting Room","Operating Theatre",
  "Radiology","CT Scanner","MRI Suite",

  "Code Blue","Code Red","Cardiac Arrest","Respiratory Failure",
  "Sepsis","Stroke Alert","Major Trauma","Anaphylaxis",
  "Hypoglycaemia","Overdose","Burns","Unconscious Patient",

  "Medical Chart","Drug Round","Handover","Radio Call",
  "Patient Transfer","Consent Form","Observation Chart",
  "Triage Tag","Time Critical","Life Support",

  "Night Shift","Bleeding Control","FAST Test",
  "Blue Light Run","Sirens On","Stabilise Patient"
];

const LINES = [
  [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],
  [15,16,17,18,19],[20,21,22,23,24],
  [0,5,10,15,20],[1,6,11,16,21],
  [2,7,12,17,22],[3,8,13,18,23],
  [4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]
];

let card=[], marked=[], called=[], lastReset=null;

document.getElementById("startBtn").onclick = async () => {
  const name = document.getElementById("name").value.trim();
  const mode = document.getElementById("mode").value;
  if (!name) return alert("Enter name");

  const pool = mode==="numbers"
    ? Array.from({length:75},(_,i)=>i+1)
    : WORDS;

  card = [...pool].sort(()=>0.5-Math.random()).slice(0,25);
  card[12] = "FREE";
  marked = Array(25).fill(false);
  marked[12] = true;

  await db.collection("players").doc(name).set({
    card, marked, cardMode: mode,
    bingo:false, nearBingo:false
  });

  document.getElementById("player").innerText = name;
  document.getElementById("login").style.display = "none";
  document.getElementById("game").style.display = "block";
  render();
};

function render() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  card.forEach((v,i)=>{
    const active = called.includes(v) || v==="FREE";
    const c = document.createElement("div");
    c.className = "cell" + (marked[i]?" marked":"") + (active?" active":"");
    c.innerText = v;
    if (active) {
      c.onclick = async () => {
        marked[i] = !marked[i];
        render();
        await db.collection("players").doc(player.innerText).update({marked});
      };
    }
    grid.appendChild(c);
  });

  document.getElementById("called").innerHTML =
    called.map(x=>`<span>${x}</span>`).join("");

  updateNear();
}

function updateNear() {
  let near=false;
  LINES.forEach(l=>{
    if(l.filter(i=>marked[i]).length===4) near=true;
  });
  document.getElementById("near").innerText =
    near ? "âš ï¸ You are one away from Bingo!" : "";

  db.collection("players").doc(player.innerText)
    .update({nearBingo:near});
}

document.getElementById("claimBtn").onclick = async () => {
  const win = LINES.some(l=>l.every(i=>marked[i]));
  if (!win) return alert("No bingo yet");

  await db.collection("players").doc(player.innerText)
    .update({bingo:true,time:new Date().toISOString()});

  alert("Bingo claimed!");
};

db.collection("game").doc("state").onSnapshot(doc=>{
  if (!doc.exists) return;
  const d = doc.data();
  called = d.called || [];

  if (lastReset!==null && d.resetCounter>lastReset) {
    alert("Game reset");
    location.reload();
  }
  lastReset = d.resetCounter;
  render();
});
</script>
</body>
</html>
