<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo Classic</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4fbfa;
  text-align: center;
  padding: 20px;
}
h1 { color: #c62828; }
input, button {
  padding: 8px;
  font-size: 16px;
  margin: 5px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(5, 100px);
  gap: 8px;
  justify-content: center;
  margin-top: 20px;
}
.cell {
  background: #fff;
  border: 2px solid #333;
  border-radius: 8px;
  padding: 6px;
  min-height: 70px;

  font-weight: bold;
  font-size: 12px;
  line-height: 1.1;
  text-align: center;

  display: flex;
  align-items: center;
  justify-content: center;

  word-wrap: break-word;
  white-space: normal;

  opacity: 0.5;
}
.cell.active { cursor: pointer; opacity: 1; }
.cell.marked { background: #c62828; color: white; }
</style>
</head>

<body>

<h1>ðŸ©º Medic Bingo Classic</h1>
<p>Enter your Discord name</p>

<input id="name" placeholder="Discord Name">
<br>
<button onclick="startGame()">Get My Bingo Card</button>

<div id="game" style="display:none;">
  <h2 id="playerName"></h2>
  <div class="grid" id="grid"></div>
  <br>
  <button onclick="claimBingo()">ðŸŽ‰ Claim Bingo</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ PASTE YOUR firebaseConfig BELOW (REPLACE THIS ONE) */
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const bingoWords = [
  "Stethoscope","CPR","Bandages","IV Drip","Ambulance",
  "Trauma Kit","Scrubs","Vital Signs","Code Blue","Defibrillator",
  "Syringe","First Responder","Triage","Pulse Check","Oxygen Mask",
  "Heart Monitor","Gloves","Blood Pressure","Paramedic",
  "Emergency Room","Stretchers","Radio Call","Life Support",
  "Medical Chart","Scalpel","Face Mask","Disinfectant",
  "Thermometer","AED","Patient Transport"
];

let card = [];
let marked = [];
let calledWords = [];

function generateCard() {
  let shuffled = [...bingoWords].sort(() => 0.5 - Math.random());
  let card = shuffled.slice(0, 25);
  card[12] = "ðŸ©º FREE";
  return card;
}

async function startGame() {
  const name = document.getElementById("name").value.trim();
  if (!name) return alert("Enter your Discord name");

  const gameDoc = await db.collection("game").doc("state").get();
  calledWords = gameDoc.exists ? gameDoc.data().calledWords : [];

  const doc = await db.collection("players").doc(name).get();
  if (doc.exists) {
    card = doc.data().card;
    marked = doc.data().marked;
  } else {
    card = generateCard();
    marked = Array(25).fill(false);
    marked[12] = true;
    await db.collection("players").doc(name).set({
      card, marked, bingo:false, time:null
    });
  }

  document.getElementById("playerName").innerText = name;
  document.getElementById("game").style.display = "block";
  render();
}

function render() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  card.forEach((v,i)=>{
    const c = document.createElement("div");
    const active = calledWords.includes(v) || v==="ðŸ©º FREE";
    c.className = "cell" + (marked[i]?" marked":"") + (active?" active":"");
    c.innerText = v;
    if(active){
      c.onclick = async ()=>{
        marked[i] = !marked[i];
        render();
        const name = document.getElementById("playerName").innerText;
        await db.collection("players").doc(name).update({marked});
      };
    }
    grid.appendChild(c);
  });
}

function checkBingo() {
  const wins=[[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],
  [15,16,17,18,19],[20,21,22,23,24],
  [0,5,10,15,20],[1,6,11,16,21],
  [2,7,12,17,22],[3,8,13,18,23],
  [4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]];
  return wins.some(w=>w.every(i=>marked[i]));
}

async function claimBingo(){
  // ðŸ”’ prevent cheating
  if (!checkBingo()) {
    alert("âŒ You don't have Bingo yet!");
    return;
  }

  const name = document.getElementById("playerName").innerText;
  const ref = db.collection("players").doc(name);
  const snap = await ref.get();

  // prevent double claims
  if (snap.exists && snap.data().bingo === true) {
    alert("âš ï¸ You already claimed Bingo.");
    return;
  }

  await ref.set({
    bingo: true,
    time: new Date().toISOString()
  }, { merge: true });

  alert("ðŸŽ‰ Bingo claimed!");
}

let lastReset = null;

db.collection("game").doc("state").onSnapshot(doc => {
  if (!doc.exists) return;

  const data = doc.data();
  calledWords = data.calledWords || [];

  // Only react if resetCounter exists AND increases
  if (
    typeof data.resetCounter === "number" &&
    lastReset !== null &&
    data.resetCounter > lastReset
  ) {
    alert("The game has been reset by the host.");
    location.reload();
  }

  lastReset = typeof data.resetCounter === "number"
    ? data.resetCounter
    : lastReset;

  render();
});
</script>

</body>
</html>







