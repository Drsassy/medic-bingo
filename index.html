<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo</title>

<style>
body {
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#eaf6f6,#fff);
  padding:30px;
  text-align:center;
}
.card {
  background:white;
  border-radius:14px;
  padding:22px;
  margin:0 auto 20px;
  max-width:650px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
.grid {
  display:grid;
  grid-template-columns:repeat(5,100px);
  gap:10px;
  justify-content:center;
}
.cell {
  border:2px solid #333;
  border-radius:10px;
  height:85px;
  font-size:11px;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:.4;
}
.cell.active {opacity:1;cursor:pointer;}
.cell.marked {background:#b71c1c;color:white;}
.calledBox span {
  display:inline-block;
  background:#f2f2f2;
  padding:6px 10px;
  margin:4px;
  border-radius:6px;
  font-weight:bold;
}
#nearBanner {
  margin-top:15px;
  font-weight:bold;
  color:#d32f2f;
}
</style>
</head>

<body>

<h1>ðŸ©º Medic Bingo</h1>

<div class="card" id="login">
  <input id="name" placeholder="Discord name">
  <br><br>
  <button onclick="startGame()">Get My Bingo Card</button>
</div>

<div class="card" id="game" style="display:none;">
  <h2 id="playerName"></h2>
  <div id="nearBanner"></div>
  <div class="grid" id="grid"></div>
  <br>
  <button onclick="claimBingo()">ðŸŽ‰ Claim Bingo</button>
</div>

<div class="card">
  <h3>ðŸ“¢ Called So Far</h3>
  <div class="calledBox" id="calledList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"PASTE",
  authDomain:"PASTE",
  projectId:"PASTE",
  storageBucket:"PASTE",
  messagingSenderId:"PASTE",
  appId:"PASTE"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

db.collection("game").doc("state").set({
  called:[],
  resetCounter:0,
  mode:"words"
},{merge:true});

const words=[
  "Stethoscope","CPR","Bandages","IV Drip","Ambulance",
  "Trauma Kit","Scrubs","Vital Signs","Code Blue","Defibrillator",
  "Syringe","First Responder","Triage","Pulse Check","Oxygen Mask",
  "Heart Monitor","Gloves","Blood Pressure","Paramedic",
  "Emergency Room","Stretchers","Radio Call","Life Support",
  "Medical Chart","Scalpel","Face Mask","Disinfectant",
  "Thermometer","AED","Patient Transport"
];

const LINES=[
  {idx:[0,1,2,3,4],name:"Top Row"},
  {idx:[5,6,7,8,9],name:"Second Row"},
  {idx:[10,11,12,13,14],name:"Middle Row"},
  {idx:[15,16,17,18,19],name:"Fourth Row"},
  {idx:[20,21,22,23,24],name:"Bottom Row"},
  {idx:[0,5,10,15,20],name:"Column B"},
  {idx:[1,6,11,16,21],name:"Column I"},
  {idx:[2,7,12,17,22],name:"Column N"},
  {idx:[3,8,13,18,23],name:"Column G"},
  {idx:[4,9,14,19,24],name:"Column O"},
  {idx:[0,6,12,18,24],name:"Diagonal â†˜"},
  {idx:[4,8,12,16,20],name:"Diagonal â†™"}
];

let card=[],marked=[],called=[],mode="words",lastReset=null;

function generateCard(){
  const pool=mode==="numbers"
    ? Array.from({length:75},(_,i)=>i+1)
    : words;
  const c=[...pool].sort(()=>0.5-Math.random()).slice(0,25);
  c[12]="FREE";
  return c;
}

async function startGame(){
  const name=document.getElementById("name").value.trim();
  if(!name) return alert("Enter name");

  const ref=db.collection("players").doc(name);
  const snap=await ref.get();

  if(snap.exists){
    card=snap.data().card;
    marked=snap.data().marked;
  } else {
    card=generateCard();
    marked=Array(25).fill(false);
    marked[12]=true;
    await ref.set({card,marked,bingo:false,nearBingo:false});
  }

  document.getElementById("playerName").innerText=name;
  document.getElementById("login").style.display="none";
  document.getElementById("game").style.display="block";
  render();
}

function render(){
  const g=document.getElementById("grid");
  g.innerHTML="";
  card.forEach((v,i)=>{
    const c=document.createElement("div");
    const active=called.includes(v)||v==="FREE";
    c.className="cell"+(marked[i]?" marked":"")+(active?" active":"");
    c.innerText=v;
    if(active){
      c.onclick=async()=>{
        marked[i]=!marked[i];
        render();
        const name=document.getElementById("playerName").innerText;
        await db.collection("players").doc(name).update({marked});
      };
    }
    g.appendChild(c);
  });

  document.getElementById("calledList").innerHTML =
    called.map(x=>`<span>${x}</span>`).join("");

  updateNearBingo();
}

function updateNearBingo(){
  const name=document.getElementById("playerName").innerText;
  let near=false,line="";
  LINES.forEach(l=>{
    const count=l.idx.filter(i=>marked[i]).length;
    if(count===4){near=true;line=l.name;}
  });

  document.getElementById("nearBanner").innerText=
    near?`âš ï¸ One away on ${line}!`:"";

  db.collection("players").doc(name)
    .set({nearBingo:near,nearLine:line},{merge:true});
}

function checkBingo(){
  return LINES.some(l=>l.idx.every(i=>marked[i]));
}

async function claimBingo(){
  if(!checkBingo()) return alert("No Bingo yet");
  const name=document.getElementById("playerName").innerText;
  await db.collection("players").doc(name)
    .set({bingo:true,time:new Date().toISOString()},{merge:true});
  alert("Bingo claimed!");
}

db.collection("game").doc("state").onSnapshot(doc=>{
  if(!doc.exists) return;
  const d=doc.data();
  called=d.called||[];
  mode=d.mode||"words";

  if(lastReset!==null && d.resetCounter>lastReset){
    alert("Game reset");
    location.reload();
  }
  lastReset=d.resetCounter;
  render();
});
</script>
</body>
</html>
