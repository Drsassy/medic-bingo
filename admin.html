<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo Admin</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}
button {
  padding: 8px 14px;
  font-size: 16px;
  margin: 5px 0;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>ğŸ©º Medic Bingo â€“ Admin Panel</h1>

<h2>ğŸ² Call Random Word</h2>
<button onclick="callRandomWord()">Call Random Word</button>
<p id="lastWord"><em>No word called yet</em></p>

<h2>ğŸ† Winners (Live)</h2>
<ul id="winners">
  <li>No winners yet</li>
</ul>

<h2>ğŸ” Reset Game</h2>
<button onclick="resetGame()">RESET GAME</button>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”¥ REPLACE THIS WITH YOUR REAL firebaseConfig */
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// âœ… Ensure game state document exists
db.collection("game").doc("state").set({
  calledWords: [],
  resetCounter: 0
}, { merge: true });

/* ğŸ©º MEDIC BINGO WORDS */
const bingoWords = [
  "Stethoscope","CPR","Bandages","IV Drip","Ambulance",
  "Trauma Kit","Scrubs","Vital Signs","Code Blue","Defibrillator",
  "Syringe","First Responder","Triage","Pulse Check","Oxygen Mask",
  "Heart Monitor","Gloves","Blood Pressure","Paramedic",
  "Emergency Room","Stretchers","Radio Call","Life Support",
  "Medical Chart","Scalpel","Face Mask","Disinfectant",
  "Thermometer","AED","Patient Transport"
];

/* ğŸ² CALL RANDOM WORD (NO REPEATS) */
async function callRandomWord() {
  const ref = db.collection("game").doc("state");
  const doc = await ref.get();

  let called = doc.exists ? doc.data().calledWords : [];
  const remaining = bingoWords.filter(w => !called.includes(w));

  if (remaining.length === 0) {
    alert("All words have been called!");
    return;
  }

  const word = remaining[Math.floor(Math.random() * remaining.length)];
  called.push(word);

  await ref.update({ calledWords: called });
  document.getElementById("lastWord").innerText = "Last called: " + word;
}

// ğŸ† LIVE WINNER LISTENER (FINAL, STABLE)
db.collection("players")
  .where("bingo", "==", true)
  .onSnapshot(snapshot => {

    const list = document.getElementById("winners");
    list.innerHTML = "";

    if (snapshot.empty) {
      list.innerHTML = "<li>No winners yet</li>";
      return;
    }

    snapshot.forEach(doc => {
      const data = doc.data();
      const li = document.createElement("li");
      li.textContent = `${doc.id} â€” ${data.time}`;
      list.appendChild(li);
    });
  });

/* ğŸ” RESET GAME */
async function resetGame() {
  if (!confirm("Are you sure you want to reset the entire game?")) return;

  // delete all players
  const players = await db.collection("players").get();
  players.forEach(doc => doc.ref.delete());

  // increment reset counter
  const ref = db.collection("game").doc("state");
  const doc = await ref.get();
  const resetCounter = doc.exists && doc.data().resetCounter
    ? doc.data().resetCounter + 1
    : 1;

  await ref.set({
    calledWords: [],
    resetCounter: resetCounter
  });

  document.getElementById("lastWord").innerText = "No word called yet";
  alert("Game has been reset");
}
</script>

</body>
</html>




