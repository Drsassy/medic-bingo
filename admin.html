<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo â€“ Admin</title>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg,#eef2f7,#ffffff);
  padding: 30px;
}
h1,h2 { color:#c62828; }
.card {
  background: white;
  border-radius: 18px;
  padding: 24px;
  margin-bottom: 22px;
  max-width: 760px;
  box-shadow: 0 15px 40px rgba(0,0,0,.12);
}
button,select {
  padding: 14px 20px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
button { background:#c62828; color:white; }
button.reset { background:#000; }
ul li {
  background:#f7fdfc;
  padding:10px;
  border-radius:10px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<h1>ğŸ©º Medic Bingo â€” Admin</h1>

<div class="card">
  <h2>ğŸ® Calling Mode</h2>
  <select id="callMode" onchange="setCallMode()">
    <option value="words">Medic Words</option>
    <option value="numbers">Numbers (1â€“75)</option>
  </select>
</div>

<div class="card">
  <h2>ğŸ² Call Next</h2>
  <button onclick="callNext()">Call Item</button>
  <p id="lastCall"><em>Nothing called yet</em></p>
</div>

<div class="card">
  <h2>ğŸ† Winners</h2>
  <ul id="winners"><li>None yet</li></ul>
</div>

<div class="card">
  <h2>ğŸ”¥ Close to Bingo</h2>
  <ul id="near"><li>No one close</li></ul>
</div>

<div class="card">
  <h2>ğŸ” Reset Game</h2>
  <button class="reset" onclick="resetGame()">RESET GAME</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const WORDS = [
  "Stethoscope","CPR","Bandages","IV Drip","Ambulance",
  "Trauma Kit","Scrubs","Vital Signs","Code Blue","Defibrillator",
  "Syringe","First Responder","Triage","Pulse Check","Oxygen Mask",
  "Heart Monitor","Gloves","Blood Pressure","Paramedic",
  "Emergency Room","Stretchers","Radio Call","Life Support",
  "Medical Chart","Scalpel","Face Mask","Disinfectant",
  "Thermometer","AED","Patient Transport"
];

// Ensure game state
db.collection("game").doc("state").set({
  called: [],
  callMode: "words",
  resetCounter: 0
}, { merge:true });

async function setCallMode() {
  await db.collection("game").doc("state").update({
    callMode: callMode.value,
    called: []
  });
  lastCall.innerText = "Calling mode switched";
}

async function callNext() {
  const ref = db.collection("game").doc("state");
  const data = (await ref.get()).data();

  const pool = data.callMode === "numbers"
    ? Array.from({length:75},(_,i)=>i+1)
    : WORDS;

  const remaining = pool.filter(x => !data.called.includes(x));
  if (!remaining.length) return alert("All items called");

  const pick = remaining[Math.floor(Math.random()*remaining.length)];
  await ref.update({ called:[...data.called, pick] });

  lastCall.innerText = "Last called: " + pick;
}

// Winners
db.collection("players").where("bingo","==",true)
.onSnapshot(snap=>{
  winners.innerHTML = snap.empty ? "<li>None yet</li>" : "";
  snap.forEach(d => {
    winners.innerHTML += `<li>${d.id}</li>`;
  });
});

// Close to bingo
db.collection("players").where("nearBingo","==",true)
.onSnapshot(snap=>{
  near.innerHTML = snap.empty ? "<li>No one close</li>" : "";
  snap.forEach(d => {
    near.innerHTML += `<li>${d.id} â†’ ${d.data().nearLine}</li>`;
  });
});

async function resetGame() {
  const players = await db.collection("players").get();
  players.forEach(p => p.ref.delete());

  await db.collection("game").doc("state").update({
    called: [],
    resetCounter: firebase.firestore.FieldValue.increment(1)
  });
}
</script>
</body>
</html>
