<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo â€“ Admin</title>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg,#eef2f7,#ffffff);
  padding: 30px;
}
h1,h2 { color:#c62828; }
.card {
  background: white;
  border-radius: 18px;
  padding: 24px;
  margin-bottom: 22px;
  max-width: 760px;
  box-shadow: 0 15px 40px rgba(0,0,0,.12);
}
button,select {
  padding: 14px 20px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
button { background:#c62828; color:white; }
button.reset { background:#000; }
ul li {
  background:#f7fdfc;
  padding:10px;
  border-radius:10px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<h1>ğŸ©º Medic Bingo â€” Admin</h1>

<div class="card">
  <h2>ğŸ® Calling Mode</h2>
  <select id="callMode">
    <option value="words">Medic Words</option>
    <option value="numbers">Numbers (1â€“75)</option>
  </select>
</div>

<div class="card">
  <h2>ğŸ² Call Next</h2>
  <button id="callBtn">Call Item</button>
  <p id="lastCall"><em>Nothing called yet</em></p>
</div>

<div class="card">
  <h2>ğŸ† Winners</h2>
  <ul id="winners"><li>None yet</li></ul>
</div>

<div class="card">
  <h2>ğŸ”¥ Close to Bingo</h2>
  <ul id="near"><li>No one close</li></ul>
</div>

<div class="card">
  <h2>ğŸ” Reset Game</h2>
  <button class="reset" id="resetBtn">RESET GAME</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ğŸ”´ LARGE WORD LIST */
const WORDS = [
  "Stethoscope","Blood Pressure Cuff","Pulse Oximeter","Thermometer",
  "Defibrillator","AED","IV Pump","IV Drip","Syringe","Needle",
  "Oxygen Tank","Oxygen Mask","Bag Valve Mask","Ventilator",
  "Heart Monitor","ECG Leads","Ultrasound","Laryngoscope",
  "Suction Unit","Crash Cart",

  "Gloves","Face Mask","Gown","Visor","Sanitiser",
  "Disinfectant","Sharps Bin","Biohazard Bag","Sterile Field",
  "Dressings","Bandages","Gauze","Tourniquet","Splint",
  "Cervical Collar","Backboard",

  "CPR","Intubation","Cannulation","Blood Draw",
  "Airway Management","Oxygen Therapy","Fluid Resuscitation",
  "Wound Cleaning","Suturing","Manual Ventilation",
  "Rapid Sequence Induction","Defib Shock","Vitals Check",
  "Pain Assessment","Neuro Check",

  "Paramedic","EMT","First Responder","Charge Nurse",
  "Triage Nurse","Consultant","Registrar","Medical Student",
  "Anaesthetist","Radiographer","Pharmacist",

  "Emergency Room","Resus Bay","Trauma Room","ICU",
  "Ambulance","Helipad","Waiting Room","Operating Theatre",
  "Radiology","CT Scanner","MRI Suite",

  "Code Blue","Code Red","Cardiac Arrest","Respiratory Failure",
  "Sepsis","Stroke Alert","Major Trauma","Anaphylaxis",
  "Hypoglycaemia","Overdose","Burns","Unconscious Patient",

  "Medical Chart","Drug Round","Handover","Radio Call",
  "Patient Transfer","Consent Form","Observation Chart",
  "Triage Tag","Time Critical","Life Support",

  "Night Shift","Bleeding Control","FAST Test",
  "Blue Light Run","Sirens On","Stabilise Patient"
];

// ensure game state exists
db.collection("game").doc("state").set({
  called: [],
  callMode: "words",
  resetCounter: 0
}, { merge:true });

document.getElementById("callBtn").onclick = async () => {
  const ref = db.collection("game").doc("state");
  const data = (await ref.get()).data();

  const pool = data.callMode === "numbers"
    ? Array.from({length:75},(_,i)=>i+1)
    : WORDS;

  const remaining = pool.filter(x => !data.called.includes(x));
  if (!remaining.length) return alert("All items called");

  const pick = remaining[Math.floor(Math.random()*remaining.length)];
  await ref.update({ called:[...data.called, pick] });

  document.getElementById("lastCall").innerText = "Last called: " + pick;
};

document.getElementById("resetBtn").onclick = async () => {
  const players = await db.collection("players").get();
  players.forEach(p => p.ref.delete());

  await db.collection("game").doc("state").update({
    called: [],
    resetCounter: firebase.firestore.FieldValue.increment(1)
  });
};

db.collection("players").where("bingo","==",true)
.onSnapshot(snap=>{
  const ul = document.getElementById("winners");
  ul.innerHTML = snap.empty ? "<li>None yet</li>" : "";
  snap.forEach(d => ul.innerHTML += `<li>${d.id}</li>`);
});

db.collection("players").where("nearBingo","==",true)
.onSnapshot(snap=>{
  const ul = document.getElementById("near");
  ul.innerHTML = snap.empty ? "<li>No one close</li>" : "";
  snap.forEach(d => ul.innerHTML += `<li>${d.id} â†’ ${d.data().nearLine}</li>`);
});
</script>
</body>
</html>
