<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Medic Bingo Admin</title>

<style>
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#eaf6f6,#fff);
  padding:30px;
}
h1,h2{color:#b71c1c;}
.card{
  background:white;
  border-radius:16px;
  padding:22px;
  margin-bottom:20px;
  max-width:750px;
  box-shadow:0 12px 30px rgba(0,0,0,.1);
}
button,select{
  padding:12px 18px;
  font-size:15px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}
button{
  background:#b71c1c;
  color:white;
  font-weight:bold;
}
button.reset{background:#000;}
ul li{
  background:#f7fdfc;
  padding:10px;
  border-radius:8px;
  margin-bottom:6px;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>ğŸ©º Medic Bingo â€” Admin Panel</h1>

<div class="card">
  <h2>ğŸ® Game Mode</h2>
  <select id="modeSelect" onchange="setMode()">
    <option value="words">Medic Words</option>
    <option value="numbers">Numbers (1â€“75)</option>
  </select>
</div>

<div class="card">
  <h2>ğŸ² Call Next</h2>
  <button onclick="callRandom()">Call Random</button>
  <p id="lastCall"><em>Nothing called yet</em></p>
</div>

<div class="card">
  <h2>ğŸ† Winners</h2>
  <ul id="winners"><li>No winners yet</li></ul>
</div>

<div class="card">
  <h2>ğŸ”¥ Close to Bingo</h2>
  <ul id="nearList"><li>No one close yet</li></ul>
</div>

<div class="card">
  <h2>ğŸ” Reset Game</h2>
  <button class="reset" onclick="resetGame()">RESET GAME</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDASEWy-s1lBVTiXiJWx7KRvlk_IB1mN24",
    authDomain: "medic-bingo.firebaseapp.com",
    projectId: "medic-bingo",
    storageBucket: "medic-bingo.firebasestorage.app",
    messagingSenderId: "677419756545",
    appId: "1:677419756545:web:099e1928113290c587a400"
  };

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const WORDS=[
  "Stethoscope","CPR","Bandages","IV Drip","Ambulance",
  "Trauma Kit","Scrubs","Vital Signs","Code Blue","Defibrillator",
  "Syringe","First Responder","Triage","Pulse Check","Oxygen Mask",
  "Heart Monitor","Gloves","Blood Pressure","Paramedic",
  "Emergency Room","Stretchers","Radio Call","Life Support",
  "Medical Chart","Scalpel","Face Mask","Disinfectant",
  "Thermometer","AED","Patient Transport"
];

// ensure game state exists
db.collection("game").doc("state").set({
  called:[],
  resetCounter:0,
  mode:"words",
  modeVersion:0
},{merge:true});

async function setMode(){
  const ref=db.collection("game").doc("state");
  const doc=await ref.get();
  const v=(doc.data().modeVersion||0)+1;

  await ref.update({
    mode:document.getElementById("modeSelect").value,
    called:[],
    modeVersion:v
  });

  document.getElementById("lastCall").innerText="Mode changed â€” new game started";
}

async function callRandom(){
  const ref=db.collection("game").doc("state");
  const doc=await ref.get();
  const d=doc.data();

  const pool=d.mode==="numbers"
    ? Array.from({length:75},(_,i)=>i+1)
    : WORDS;

  const remaining=pool.filter(x=>!d.called.includes(x));
  if(!remaining.length) return alert("All called!");

  const pick=remaining[Math.floor(Math.random()*remaining.length)];
  await ref.update({called:[...d.called,pick]});
  document.getElementById("lastCall").innerText="Last called: "+pick;
}

db.collection("players").where("bingo","==",true)
.onSnapshot(s=>{
  const ul=document.getElementById("winners");
  ul.innerHTML=s.empty?"<li>No winners yet</li>":"";
  s.forEach(d=>{
    const li=document.createElement("li");
    li.innerText=`${d.id} â€” ${d.data().time}`;
    ul.appendChild(li);
  });
});

db.collection("players").where("nearBingo","==",true)
.onSnapshot(s=>{
  const ul=document.getElementById("nearList");
  ul.innerHTML=s.empty?"<li>No one close yet</li>":"";
  s.forEach(d=>{
    const li=document.createElement("li");
    li.innerText=`${d.id} â†’ ${d.data().nearLine}`;
    ul.appendChild(li);
  });
});

async function resetGame(){
  const players=await db.collection("players").get();
  players.forEach(p=>p.ref.delete());

  const ref=db.collection("game").doc("state");
  const doc=await ref.get();
  await ref.set({
    called:[],
    resetCounter:(doc.data().resetCounter||0)+1
  },{merge:true});
}
</script>
</body>
</html>

